<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blackjack</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
</head>
<body class="bg-dark text-light">
    <div id="app" class="container py-5 text-center">

        <h1 class="mb-4">Blackjack</h1>
        <p>Frebd</p>

        <div class="row">
            <div class="col order-2">
                <!-- Balance & Bet -->
                <div class="mb-3">
                    <h4>Zůstatek: ${{ balance }}</h4>
                    <h5>Aktuální sázka: ${{ bet }}</h5>
                    <div class="d-flex justify-content-center flex-wrap">
                        <button v-for="chip in [10,20,50,100,200]"
                                :key="chip"
                                class="btn rounded-circle fw-bold m-2"
                                :class="chipClass(chip)"
                                style="width:60px; height:60px;"
                                @click="placeBet(chip)"
                                :disabled="inGame || balance < chip">
                            ${{ chip }}
                        </button>
                    </div>

                </div>
            </div>

            <div class="col order-1">
                <!-- Dealer -->
                <div class="row mb-4">
                    <div class="col">
                        <h3>Dealer</h3>
                        <div class="d-flex justify-content-center flex-wrap">
                            <div v-for="(card, index) in dealerCards"
                                 :key="'dealer'+index"
                                 class="card m-1"
                                 :class="dealerCardClass(card, index)"
                                 style="width: 70px; height: 100px;">
                                <div class="card-body d-flex align-items-center justify-content-center p-2 fw-bold">
                                    <span v-if="!dealerTurn && index===0">?</span>
                                    <span v-else>{{ card.suit }}{{ card.rank }}</span>
                                </div>
                            </div>
                        </div>
                        <p v-if="dealerTurn">Celkem: {{ dealerTotal }}</p>
                    </div>
                </div>

                <!-- Player -->
                <div class="row mb-4">
                    <div class="col">
                        <h3>Ty</h3>
                        <div class="d-flex justify-content-center flex-wrap">
                            <div v-for="(card, index) in playerCards"
                                 :key="'player'+index"
                                 class="card m-1"
                                 :class="playerCardClass(card)"
                                 style="width: 70px; height: 100px;">
                                <div class="card-body d-flex align-items-center justify-content-center p-2 fw-bold">
                                    {{ card.suit }}{{ card.rank }}
                                </div>
                            </div>
                        </div>
                        <p>Celkem: {{ playerTotal }}</p>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="mb-3">
                <button class="btn btn-success m-1" @click="deal" :disabled="inGame || bet===0">Deal</button>
                <button class="btn btn-primary m-1" @click="hit" :disabled="!inGame">Hit</button>
                <button class="btn btn-warning m-1" @click="stand" :disabled="!inGame">Stand</button>
            </div>
        </div>

        <!-- Result -->
        <h2 class="mt-3">{{ message }}</h2>

    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                deck: [],
                playerCards: [],
                dealerCards: [],
                inGame: false,
                dealerTurn: false,
                message: 'Vsaď si...',
                balance: 1000,
                bet: 0
            },
            computed: {
                playerTotal() {
                    return this.calculateTotal(this.playerCards);
                },
                dealerTotal() {
                    return this.calculateTotal(this.dealerCards);
                }
            },
            methods: {
                createDeck() {
                    const suits = ['♠', '♥', '♦', '♣'];
                    const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                    let deck = [];
                    for (let suit of suits) {
                        for (let rank of ranks) {
                            deck.push({ suit, rank });
                        }
                    }
                    return deck.sort(() => Math.random() - 0.5);
                },
                cardValue(card) {
                    if (['J', 'Q', 'K'].includes(card.rank)) return 10;
                    if (card.rank === 'A') return 11;
                    return parseInt(card.rank);
                },
                calculateTotal(cards) {
                    let total = 0;
                    let aces = 0;
                    for (let card of cards) {
                        total += this.cardValue(card);
                        if (card.rank === 'A') aces++;
                    }
                    while (total > 21 && aces > 0) {
                        total -= 10;
                        aces--;
                    }
                    return total;
                },
                dealerCardClass(card, index) {
                    if (!this.dealerTurn && index === 0) {
                        return { 'text-primary': true, 'border-primary': true };
                    }
                    if (['♥', '♦'].includes(card.suit)) {
                        return { 'text-danger': true, 'border-danger': true };
                    }
                    return { 'text-dark': true };
                },
                placeBet(amount) {
                    if (this.balance >= amount && !this.inGame) {
                        this.bet += amount;
                        this.balance -= amount;
                    }
                },
                deal() {
                    if (this.bet === 0) return;
                    this.deck = this.createDeck();
                    this.playerCards = [this.deck.pop(), this.deck.pop()];
                    this.dealerCards = [this.deck.pop(), this.deck.pop()];
                    this.inGame = true;
                    this.dealerTurn = false;
                    this.message = '';
                },
                hit() {
                    this.playerCards.push(this.deck.pop());
                    if (this.playerTotal > 21) {
                        this.message = 'Bust! Dealer Vyhrává!';
                        this.inGame = false;
                        this.dealerTurn = true;
                        this.bet = 0;
                    }
                },
                stand() {
                    this.dealerTurn = true;
                    while (this.dealerTotal < 21 && this.dealerTotal !== 17) { 
                        this.dealerCards.push(this.deck.pop());
                    }
                    this.checkWinner();
                    this.inGame = false;
                },
                checkWinner() {
                    if (this.playerTotal > 21) {
                        this.message = 'Bust! Dealer Vyhrává!';
                        this.bet = 0;
                        return;
                    }
                    if (this.dealerTotal > 21 || this.playerTotal > this.dealerTotal) {
                        this.message = 'Vyhráváš!';
                        this.balance += this.bet * 2;
                    } else if (this.playerTotal < this.dealerTotal) {
                        this.message = 'Dealer Vyhrává!';
                    } else {
                        this.message = 'Push!';
                        this.balance += this.bet;
                    }
                    this.bet = 0;
                },
                chipClass(value) {
                    switch (value) {
                        case 10: return 'btn-success';
                        case 20: return 'btn-primary';
                        case 50: return 'btn-warning';
                        case 100: return 'btn-danger';
                        case 200: return 'btn-light';
                        default: return 'btn-secondary';
                    }
                },
                playerCardClass(card) {
                    if (['♥', '♦'].includes(card.suit)) {
                        return 'bg-white text-danger border-danger';
                    }
                    return 'bg-white text-dark border-dark';
                },
                dealerCardClass(card, index) {
                    if (!this.dealerTurn && index === 0) {
                        return 'bg-primary text-white border-white'
                    }
                    if (['♥', '♦'].includes(card.suit)) {
                        return 'bg-white text-danger border-danger';
                    }
                    return 'bg-white text-dark border-dark';
                },
            }
        });
    </script>
</body>
</html>
